{#
   This file is part of the AlphaLemon CMS Application and it is distributed
   under the GPL LICENSE Version 2.0. To use this application you must leave
   intact this copyright notice.

   Copyright (c) AlphaLemon <webmaster@alphalemon.com>

   For the full copyright and license information, please view the LICENSE
   file that was distributed with this source code.

   For extra documentation and help please visit http://www.alphalemon.com

   @license    GPL LICENSE Version 2.0
#}

<div class="images_contents pull-left">
    {% set i = 1 %}
    {% for item in alContent.getContentForEditor %}
    {% if i == 1 %}
    <ul class="thumbnails"> 
    {% endif %}
        <li class="span2">
            <a id="{{ item.id }}" href="#" class="thumbnail al_img {title: '{% if item.title is defined %}{{ item.title }}{% endif %}', alt: '{% if item.alt is defined %}{{ item.alt }}{% endif %}', thumbnail_caption: '{% if item.thumbnail_caption is defined %}{{ item.thumbnail_caption }}{% endif %}', thumbnail_width: '{% if item.thumbnail_width is defined %}{{ item.thumbnail_width }}{% endif %}'}">
                <img src="{{ item.image }}" alt="" />
            </a>
        </li>  
    {% if i == 4 %}
    </ul>
    {% set i = 0 %}
    {% endif %}
    {% set i = i + 1 %}
    {% endfor %}
</div>
<div class="images_attributes pull-right">
    <div>
        <label for="al_img_title">Title</label>
        <input id="al_img_title" value="" class="al_img_attribute" />
    </div>
    <div>
        <label for="al_img_alt">Alt</label>
        <input id="al_img_alt" value="" class="al_img_attribute" />
    </div>
    <div>
        <label for="al_img_width">Width</label>
        <div class="btn-group">
            <button id="al_img_width" class="btn">none</button>
            <button class="btn dropdown-toggle" data-toggle="dropdown">
            <span class="caret"></span>
            </button>
            <ul class="dropdown-menu">                
                <li class="al_default_image_width" rel="none">none</li>
                <li class="al_default_image_width" rel="span1">span1 (60)</li>
                <li class="al_default_image_width" rel="span2">span2 (140)</li>
                <li class="al_default_image_width" rel="span3">span3 (220)</li>
                <li class="al_default_image_width" rel="span4">span4 (300)</li>
                <li class="al_default_image_width" rel="span5">span5 (380)</li>
                <li class="al_default_image_width" rel="span6">span6 (460)</li>
                <li class="al_default_image_width" rel="span7">span7 (540)</li>
                <li class="al_default_image_width" rel="span8">span8 (620)</li>
                <li class="al_default_image_width" rel="span9">span9 (700)</li>
                <li class="al_default_image_width" rel="span10">span10 (780)</li>
                <li class="al_default_image_width" rel="span11">span11 (860)</li>
                <li class="al_default_image_width" rel="span12">span12 (940)</li>
            </ul>
        </div>
    </div>
    <div>
        <label for="thumbnail_caption">Caption</label>
        <textarea id="al_thumbnail_caption" value="" class="al_img_attribute input-xlarge" rows="6"></textarea>
    </div>
    <div>
        <button id="al_save_attributes" class="btn btn-primary">Save attributes</button>
    </div>
</div>    
<div class="clearfix"></div>
  
<script type="text/javascript">
    $(document).ready(function(){
        $('.al_default_image_width').each(function(){
            $(this).click(function(){
                $('#al_img_width').html($(this).attr('rel'));
                saveAttributes();
            });
        });
        
        $('.al_img').click(function()
        {
            var attributes;
            if ($(this).data('attributes') == null) {
                var savedAttributes = $(this).metadata();
                attributes = {
                    title: savedAttributes.title, 
                    alt: savedAttributes.alt, 
                    thumbnail_width: savedAttributes.thumbnail_width,
                    thumbnail_caption: savedAttributes.thumbnail_caption,
                };
                $(this).data('attributes', attributes);
            } else {
                attributes = $(this).data('attributes');
            }
            
            $('#al_img_title').val(attributes.title);
            $('#al_img_alt').val(attributes.alt);            
            $('#al_img_width').html(attributes.thumbnail_width);
            $('#al_thumbnail_caption').val(attributes.thumbnail_caption);
            
            var isCurrentItemSelected = $(this).hasClass('al_img_selected');
            $('.al_img').removeClass('al_img_selected');
            if(!isCurrentItemSelected) $(this).addClass('al_img_selected');

            return false;
        });
        
        $('.al_img_attribute').on('keyup', function(){
            saveAttributes();
        });
        
        $('#al_save_attributes').on('click', function(){
            var i = 0;
            var values = new Array();
            $('.al_img').each(function(){                
                var savedAttributes = $(this).data('attributes');
                if (savedAttributes == null) {
                    savedAttributes = $(this).metadata();
                }
                    
                var attributes = {
                    image: $(this).find('img').attr('src'),
                    title: savedAttributes.title, 
                    alt: savedAttributes.alt, 
                    thumbnail_width: savedAttributes.thumbnail_width,
                    thumbnail_caption: savedAttributes.thumbnail_caption
                };

                values[i] = attributes;
                i += 1;
            });
            
            $('body').EditBlock("Content", JSON.stringify(values));
        });
    });
    
    function saveAttributes() { 
        var image = $('.al_img_selected'); 
        if (image.data('attributes') == null) {
            return;
        }
        
        var attributes = {
            title: $('#al_img_title').val(), 
            alt: $('#al_img_alt').val(), 
            thumbnail_width: $('#al_img_width').html(), 
            thumbnail_caption: $('#al_thumbnail_caption').val()
        };
        console.log(attributes);
        image.data('attributes', attributes);
    }
</script>